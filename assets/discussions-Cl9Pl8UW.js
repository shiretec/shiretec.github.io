import{q as p,d as h,b as m,z as d,w as u,f as D,g as x,j as e,x as f,R as j,F as C,B as a,k as b,I as q,T as Q,o as N,y as v,D as w,s as L,C as R}from"./index-1RqBMSJE.js";import{P as I,T as S,g as T,a as z}from"./get-discussion-uSVCJH9H.js";import{T as B}from"./users-CZspSgRX.js";import{C as F,f as P}from"./confirmation-dialog-ONeR9qgT.js";const A=(s=1)=>m.get("/discussions",{params:{page:s}}),c=({page:s}={})=>p({queryKey:s?["discussions",{page:s}]:["discussions"],queryFn:()=>A(s)}),K=({queryConfig:s,page:i})=>h({...c({page:i}),...s}),M=d.object({title:d.string().min(1,"Required"),body:d.string().min(1,"Required")}),O=({data:s})=>m.post("/discussions",s),k=({mutationConfig:s}={})=>{const i=u(),{onSuccess:t,...n}=s||{};return D({onSuccess:(...r)=>{i.invalidateQueries({queryKey:c().queryKey}),t==null||t(...r)},...n,mutationFn:O})},E=()=>{const{addNotification:s}=x(),i=k({mutationConfig:{onSuccess:()=>{s({type:"success",title:"Discussion Created"})}}});return e.jsx(f,{allowedRoles:[j.ADMIN],children:e.jsx(C,{isDone:i.isSuccess,triggerButton:e.jsx(a,{size:"sm",icon:e.jsx(I,{className:"size-4"}),children:"Create Discussion"}),title:"Create Discussion",submitButton:e.jsx(a,{form:"create-discussion",type:"submit",size:"sm",isLoading:i.isPending,children:"Submit"}),children:e.jsx(b,{id:"create-discussion",onSubmit:t=>{i.mutate({data:t})},schema:M,children:({register:t,formState:n})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{label:"Title",error:n.errors.title,registration:t("title")}),e.jsx(Q,{label:"Body",error:n.errors.body,registration:t("body")})]})})})})},U=({discussionId:s})=>m.delete(`/discussions/${s}`),H=({mutationConfig:s}={})=>{const i=u(),{onSuccess:t,...n}=s||{};return D({onSuccess:(...r)=>{i.invalidateQueries({queryKey:c().queryKey}),t==null||t(...r)},...n,mutationFn:U})},V=({id:s})=>{const{addNotification:i}=x(),t=H({mutationConfig:{onSuccess:()=>{i({type:"success",title:"Discussion Deleted"})}}});return e.jsx(f,{allowedRoles:[j.ADMIN],children:e.jsx(F,{icon:"danger",title:"Delete Discussion",body:"Are you sure you want to delete this discussion?",triggerButton:e.jsx(a,{variant:"destructive",icon:e.jsx(S,{className:"size-4"}),children:"Delete Discussion"}),confirmButton:e.jsx(a,{isLoading:t.isPending,type:"button",variant:"destructive",onClick:()=>t.mutate({discussionId:s}),children:"Delete Discussion"})})})},$=({onDiscussionPrefetch:s})=>{var y,g;const[i]=N(),t=K({page:+(i.get("page")||1)}),n=u();if(t.isLoading)return e.jsx("div",{className:"flex h-48 w-full items-center justify-center",children:e.jsx(v,{size:"lg"})});const r=(y=t.data)==null?void 0:y.data,l=(g=t.data)==null?void 0:g.meta;return r?e.jsx(B,{data:r,columns:[{title:"Title",field:"title"},{title:"Created At",field:"createdAt",Cell({entry:{createdAt:o}}){return e.jsx("span",{children:P(o)})}},{title:"",field:"id",Cell({entry:{id:o}}){return e.jsx(w,{onMouseEnter:()=>{n.prefetchQuery(T(o)),s==null||s(o)},to:L.app.discussion.getHref(o),children:"View"})}},{title:"",field:"id",Cell({entry:{id:o}}){return e.jsx(V,{id:o})}}],pagination:l&&{totalPages:l.totalPages,currentPage:l.page,rootUrl:""}}):null},Y=s=>async({request:i})=>{const t=new URL(i.url),n=Number(t.searchParams.get("page")||1),r=c({page:n});return s.getQueryData(r.queryKey)??await s.fetchQuery(r)},Z=()=>{const s=u();return e.jsxs(R,{title:"Discussions",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(E,{})}),e.jsx("div",{className:"mt-4",children:e.jsx($,{onDiscussionPrefetch:i=>{s.prefetchInfiniteQuery(z(i))}})})]})};export{Y as clientLoader,Z as default};
